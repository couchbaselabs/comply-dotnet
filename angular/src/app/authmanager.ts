import {Injectable, Inject} from "@angular/core";
import {Http, Request, RequestMethod, Headers, HTTP_PROVIDERS} from "@angular/http";
import {IUser} from "./interfaces";
import {Utility} from "./utility";

@Injectable()

export class AuthManager {

    http: Http;
    utility: Utility;

    constructor(http: Http, utility: Utility) {
        this.http = http;
        this.utility = utility;
    }

    isAuthenticated() {
        if (!localStorage.getItem("user") || localStorage.getItem("user") == "") {
            return false;
        } else {
            return true;
        }
    }

    getAuthToken() {
        if (localStorage.getItem("user")) {
            return JSON.parse(localStorage.getItem("user"))._id;
        } else {
            return null;
        }
    }

    getUserName() {
        if (localStorage.getItem("user")) {
            return JSON.parse(localStorage.getItem("user")).username;
        } else {
            return null;
        }
    }

    login(username: string, password: string) {
        return new Promise((resolve, reject) => {
            this.utility.makeGetRequest("/api/user/login", [username, password]).then((result) => {
                if(result) {
                    localStorage.setItem("user", JSON.stringify(result));
                    resolve(result);
                } else {
                    reject("User not found");
                }
            }, (error) => {
                reject(error);
            });
        });
    }

    logout() {
        localStorage.clear();
    }

    register(user: IUser) {
        return this.utility.makePostRequest("/api/user/create", [], user);
    }

}
